generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  googleId  String   @unique
  email     String   @unique
  name      String?
  timezone  String?
  createdAt DateTime @default(now())
  goals     Goal[]
  tasks     Task[]
  reflections Reflection[]
  recurringTasks RecurringTask[]
}

model Goal {
  id           String    @id @default(uuid())
  userId       String
  user         User      @relation(fields: [userId], references: [id])
  level        String    // YEAR, QUARTER, MONTH, WEEK
  title        String
  description  String?
  parentGoalId String?
  parentGoal   Goal?     @relation("GoalHierarchy", fields: [parentGoalId], references: [id])
  subGoals     Goal[]    @relation("GoalHierarchy")
  tasks        Task[]
  recurringTasks RecurringTask[]
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model Task {
  id               String         @id @default(uuid())
  userId           String
  user             User           @relation(fields: [userId], references: [id])
  title            String
  description      String?
  date             String         // YYYY-MM-DD format for easier querying
  startTime        String?        // HH:mm format (e.g. "09:30")
  endTime          String?        // HH:mm format (e.g. "10:30")
  priority         Int            @default(1) // 1, 2, 3
  estimatedMinutes Int?
  goalId           String?
  goal             Goal?          @relation(fields: [goalId], references: [id])
  recurringTaskId  String?
  recurringTask    RecurringTask? @relation(fields: [recurringTaskId], references: [id], onDelete: Cascade)
  status           String         @default("TODO") // TODO, DONE, SKIPPED
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  order            Int            @default(0)
  pomodorosTotal   Int            @default(1)
  pomodorosCompleted Int          @default(0)
  focusSessions    FocusSession[]
}

model FocusSession {
  id                 String    @id @default(uuid())
  taskId             String
  task               Task      @relation(fields: [taskId], references: [id], onDelete: Cascade)
  startTime          DateTime
  endTime            DateTime?
  note               String?
  interruptionReason String?
}

model Reflection {
  id             String   @id @default(uuid())
  userId         String
  user           User     @relation(fields: [userId], references: [id])
  weekStartDate  String   // YYYY-MM-DD format (Monday of the week)
  wentWell       String?
  toImprove      String?
  accomplishments String?
  challenges     String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([userId, weekStartDate])
}

model RecurringTask {
  id               String   @id @default(uuid())
  userId           String
  user             User     @relation(fields: [userId], references: [id])
  title            String
  description      String?
  recurrencePattern String  // DAILY, WEEKDAYS, WEEKLY, CUSTOM
  daysOfWeek       String?  // JSON array for CUSTOM: [0,1,2,3,4,5,6] where 0=Sunday
  startTime        String?  // HH:mm format
  endTime          String?  // HH:mm format
  priority         Int      @default(1)
  pomodorosTotal   Int      @default(1)
  goalId           String?
  goal             Goal?    @relation(fields: [goalId], references: [id])
  isActive         Boolean  @default(true)
  tasks            Task[]   // Link to generated task instances
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}
